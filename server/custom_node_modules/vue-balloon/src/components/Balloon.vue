<template>
  <transition name="vb-transition">
    <div class="vb-wrapper" v-if="!closed">
      <div :class="classes">
        <div class="vb-header" v-if="maximized">
          <div class="vb-title" @click="maximize" v-if="maximized">{{ title }}</div>
          <div class="vb-buttons">
            <i
              class="fa fa-chevron-up"
              aria-hidden="true"
              v-if="concise && !maximized && !hideConciseButton"
              @click="concise = false"
            ></i>
            <i
              class="fa fa-chevron-down"
              aria-hidden="true"
              v-if="!concise && !maximized && !hideConciseButton"
              @click="concise = true"
            ></i>
            <i class="fa fa-compress" aria-hidden="true" v-if="maximized" @click="minimize"></i>
            <i
              class="fa fa-close"
              aria-hidden="true"
              v-if="(showCloseWhenMaximized || !maximized) && !hideCloseButton"
              @click="close"
            ></i>
          </div>
        </div>
        <div v-else class="custom-header">
          <div class="foo">
            <i class="fab fa-facebook-messenger fa-3x" @click="maximize"/>
          </div>
        </div>
        <div class="vb-content">
          <div class="vb-content-slot">
            <slot></slot>
          </div>
          <div class="vb-minimized-overlay" v-if="!maximized" @click="maximize">
            <i class="fa fa-expand" aria-hidden="true"></i>
          </div>
        </div>
      </div>
      <transition name="vb-transition">
        <div class="vb-maximized-overlay" v-if="maximized" @click="minimize"></div>
      </transition>
    </div>
  </transition>
</template>

<script>
export default {
  props: {
    // balloon title
    title: {
      default: "",
      type: String
    },

    // position: bottom-right, bottom-left, top-right, or top-left
    position: {
      default: "bottom-right",
      type: String
    },

    // enable the css transform: scale() effect
    zooming: {
      default: false,
      type: Boolean
    },

    // hide the close (x) icon on the balloon
    hideCloseButton: {
      default: false,
      type: Boolean
    },

    // hide the concise (chevron) icons on the balloon
    hideConciseButton: {
      default: false,
      type: Boolean
    },

    // when balloon is created it will have this initial 'concise' state
    initiallyConcise: {
      default: false,
      type: Boolean
    },

    // when balloon is maximized, it will still have the close button
    showCloseWhenMaximized: {
      default: false,
      type: Boolean
    },

    //* vb internal props *//

    // keep track of state with multiple balloons
    balloonState: {
      default() {
        return {
          maximized: null
        };
      },
      type: Object
    },

    // remember the original balloon object to store in the balloon state
    balloon: {
      default() {
        return {};
      },
      type: Object
    },

    // force the minimized state, used in the balloon set dock
    forceMinimized: {
      default: false,
      type: Boolean
    }
  },

  data() {
    return {
      concise: this.initiallyConcise,
      closed: false
    };
  },

  watch: {
    "balloonState.maximized"(n, o) {
      // if maximized balloon changed from this one trigger a minimize event
      if (o === this.balloon && n !== this.balloon) {
        this.$emit("minimize", this);
        // else if maximized balloon changed to this one trigger a maximize event
      } else if (o !== this.balloon && n === this.balloon) {
        this.$emit("maximize", this);
      }
    }
  },

  computed: {
    classes() {
      return [
        "vb",
        this.position ? `vb-${this.position}` : "",
        this.concise ? "vb-concise" : "",
        this.maximized ? "vb-maximized" : "",
        !this.maximized && this.zooming ? "vb-zoomed-out" : ""
      ];
    },

    maximized() {
      return (
        this.balloonState.maximized === this.balloon && !this.forceMinimized
      );
    }
  },

  methods: {
    close() {
      this.closed = true;
      this.$emit("close", this);
    },

    open() {
      this.closed = false;
      this.$emit("open", this);
    },

    maximize() {
      this.balloonState.maximized = this.balloon;
    },

    minimize() {
      this.balloonState.maximized = null;
    }
  }
};
</script>

<style lang="scss" scoped>
.foo {
  display: flex;
  align-items: center;
  justify-content: center;
  background: #158ce4;
  animation: corner 3s;
  border-radius: 50%;
  animation-iteration-count: infinite;
  animation-timing-function: linear;
  position: absolute;

  margin: auto;
}
$s: 100% / 8;
$t: 0.001%;

@keyframes corner {
  #{$s * 0} {
    border-top-left-radius: 1% 50%;
  }
  #{$s * 1} {
    border-top-left-radius: 50%;
    border-top-right-radius: 50%;
  }
  #{$s * 2} {
    border-top-right-radius: 1% 50%;
  }
  #{$s * 2 + $t} {
    border-top-right-radius: 50% 1%;
  }
  #{$s * 3} {
    border-top-right-radius: 50%;
    border-bottom-right-radius: 50%;
  }
  #{$s * 4} {
    border-bottom-right-radius: 50% 1%;
  }
  #{$s * 4 + $t} {
    border-bottom-right-radius: 1% 50%;
  }
  #{$s * 5} {
    border-bottom-right-radius: 50%;
    border-bottom-left-radius: 50%;
  }
  #{$s * 6} {
    border-bottom-left-radius: 1% 50%;
  }
  #{$s * 6 + $t} {
    border-bottom-left-radius: 50% 1%;
  }
  #{$s * 7} {
    border-bottom-left-radius: 50%;
    border-top-left-radius: 50%;
  }
  #{$s * 8} {
    border-top-left-radius: 50% 1%;
  }
}

.foo:hover {
  background: red;
}
.fa-facebook-messenger {
  margin: 5px;
  color: #fff;
}

.custom-header {
  padding: 10px;
  margin: 10px;
}
</style>
